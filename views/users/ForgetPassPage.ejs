<% layout("/layouts/boilerplate") -%>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forget Password Form</title>
  </head>
  <body>
    <style>
      .otpsent {
        width: 70%;
        border: 1px solid black;
        text-align: center;
        font-size: larger;
        background-color: rgb(185, 243, 99);
        border-radius: 2rem;
      }
    </style>
    <div class="row mt-4">
      <div class="col-6 offset-3">
        <h3 class="mb-3">Welcome User on üåêSocialBook</h3>

        <form
          method="post"
          action="/forgetPass"
          novalidate
          class="needs-validation"
        >
          <div>
            <label for="checkEmail" class="form-label">Enter Username</label>
            <input
              type="text"
              name="checkUsername"
              placeholder="UserName"
              class="form-control"
              id=""
              required
              value="<%= checkUsername %>"
            />
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback">UserName required</div>
          </div>

          <div class="mt-3">
            <label for="checkEmail" class="form-label"
              >Enter Email Address</label
            >
            <input
              type="email"
              name="checkEmail"
              placeholder="Email"
              class="form-control"
              id=""
              required
              value="<%= checkEmail %>"
            />
            <div class="valid-feedback">Looks good!</div>
            <div class="invalid-feedback">Email required</div>
            <button class="mt-3 btn btn-success">Send</button>
          </div>
        </form>

        <% if(isOTPsent){ %>
        <div class="otpsent mt-3">
          <h4 style="margin-bottom: 0">
            OTP Successfully sent to <%= targetUser.email %>
          </h4>
        </div>

        <div class="mt-3">
          <form
            method="post"
            id="checkOTPForm"
            action="/forgetPass"
            novalidate
            class="needs-validation"
          >
            <label for="EntdOTP" class="form-label">Enter OTP</label>
            <input
              id="EntdOTP"
              type="text"
              name="EntdOTP"
              class="form-control"
              required
            />
            <input
              type="text"
              id="sendOTP"
              name="sendOTP"
              style="display: none"
              value="<%= sendOTP %>"
            />
            <input
              type="text"
              name="checkUsername"
              style="display: none"
              value="<%= checkUsername %>"
            />
            <input
              type="text"
              name="checkEmail"
              style="display: none"
              value="<%= checkEmail %>"
            />
            <div class="invalid-feedback">OTP required</div>
            <div
              id="invalidOTP"
              style="display: none"
              class="invalid-feedback mb-3"
            >
              <p>Wrong OTP !!!</p>
            </div>
            <button class="btn btn-success mt-3">Verify OTP</button>
          </form>
          <p style="display: none"><%= sendOTP %></p>
        </div>
        <% } %>
      </div>
    </div>
  </body>
  <script>
    let form = document.getElementById("checkOTPForm");
    let sendOTP = document.getElementById("sendOTP");
    let EntdOTP = document.getElementById("EntdOTP");
    let invalidOTP = document.getElementById("invalidOTP");

    form.addEventListener("submit", function (event) {
      event.preventDefault();
      if (EntdOTP.value === sendOTP.value) {
        invalidOTP.style.display = "none";
        form.submit();
      } else {
        invalidOTP.style.display = "block";
      }
    });
  </script>
</html>
